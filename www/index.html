<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
        
    <link rel="icon" type="image/x-icon" href="./assets/imgs/favicons/favicon.ico" />
    <link rel="icon" type="image/png" href="./assets/imgs/favicons/favicon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="./assets/imgs/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="./assets/imgs/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="./assets/imgs/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="./assets/imgs/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="./assets/imgs/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="./assets/imgs/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./assets/imgs/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="./assets/imgs/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/imgs/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="./assets/imgs/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/imgs/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="./assets/imgs/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./assets/imgs/favicons/favicon-16x16.png">
    <link rel="manifest" href="./assets/imgs/favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="./assets/imgs/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    
    <title>Trash Connect / Codefest 2016</title>
    <meta name="description" content="Trash Connect / Codefest 2016">
    
    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Trash Connect / Codefest 2016 / ">
    <meta itemprop="description" content="Trash Connect / Codefest 2016">
    <meta itemprop="image" content="./assets/imgs/social-sharing.jpg">

    <!-- Twitter Card data -->
    <meta name="twitter:title" content="Trash Connect / Codefest 2016 / ">
    <meta name="twitter:description" content="Trash Connect / Codefest 2016">

    <!-- Open Graph data -->
    <meta property="og:site_name" content="Trash Connect / Codefest 2016" />
    <meta property="og:title" content="Trash Connect / Codefest 2016 / " />
    <meta property="og:description" content="Trash Connect / Codefest 2016" />
    <meta property="og:url" content="/" />
    <meta property="og:image" content="./assets/imgs/social-sharing.jpg" />
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="./assets/css/style.css">
    <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="./assets/js/modal.js"></script>
</head>

  <body class="home">
    <div class="wrapper">
        <div class="login-wrap">
            <img src="./assets/imgs/logo_color.svg" onerror="this.src='./assets/imgs/logo_color.png'; this.onerror=null;" class="logo">
			<style>
				.shift-end-stuff {
					display: none;
				}
			</style>

            <form class="login-form" id="login-form">
                <label for="name">Name</label>
                <select class="required-field" id="user_id" name="user_id">
					<option value="0">Please Select Your Name</option>
                </select>

                <label for="password">Password</label>
                <input class="required-field" type="password" name="password" id="password" placeholder="*********">
                
                <label class="shift-end-stuff" for="shift-end">What time does your shift end?</label>
                <input type="time" class="shift-end-stuff" name="shift-end" id="shift-end">
                
                <button id="login-btn" style="display: none">Login <i class="fa fa-caret-right"></i></button>
                
                <script>
                    //Need to add logic so that if you are an admin, then the change of pw prompts the submit; if you are a reg user, its the shift time change
                    $(document).ready(function() {
						//populate user select list
						$.get(
							"http://2016.pgh.codes/api/users.php",
							{},
							function(response) {
								$.each(response.users, function(index, user) {
									$('#user_id').append(
										$('<option>', { value: user.userid, label: user.username, text: user.username, class: 'user-type-' + user.type })
									);
								});
							},
							"json"
						);
						
						//When selecting a user, check if shift-end is necessary
						$('#user_id').change(function() {
							var selected_index = $(this).prop('selectedIndex');
							var selected_option = $(this)[0][selected_index];
							if($(selected_option).hasClass('user-type-4')) {
								$('#shift-end').addClass('required-field');
								$('.shift-end-stuff').fadeIn('fast');
							} else {
								$('#shift-end').removeClass('required-field');
								$('.shift-end-stuff').fadeOut('fast');
							}
						});

						var check_for_login = function() {
							var reveal_button = true;
							$('.required-field').each(function(index, field) {
								if(!$(field).val()) {
									reveal_button = false;
								}
							});
							if(reveal_button) {
								$('#login-btn').slideDown(300);
							} else {
								$('#login-btn').slideUp(300);
							}
						}
						
						//When user enters data in a field, check all fields for data
						//When all have data, show login button
						$('.required-field').change(check_for_login);
						$('.required-field').keypress(check_for_login);
						
						//make an API call to validate the login
						$('#login-btn').click(function(event) {
							event.preventDefault();
							
							var body = "{ \"userid\": " + $('#user_id').val() + ", \"password\": \"" + $('#password').val() + "\" }";
							console.log(body);
							$.post(
								"http://2016.pgh.codes/api/auth/login.php",
								body,
								function(response) {
									console.log(response);
									if(response.success) {
										var selected_index = $('#user_id').prop('selectedIndex');
										var selected_option = $('#user_id')[0][selected_index];
										if($(selected_option).hasClass('user-type-3')) {
											location.href = "pdp-staff.html";
										} else if($(selected_option).hasClass('user-type-4')) {
											location.href = "dpw-staff.html";
										} else {
											location.href = "admin.html";
										}
									} else {
										alert('Bad Password');
									}
								},
								"json"
							).fail(function(jqXHR, textStatus, errorThrown) { console.log(jqXHR); console.log(textStatus); console.log(errorThrown); });
						});
                    });
                </script>
            </form>
        </div>
        
        <div class="push"></div>
    </div>
      
    <footer>
        &nbsp;
    </footer>

  </body>

</html>
